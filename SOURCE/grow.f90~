!======================================================================!
SUBROUTINE GROW
!----------------------------------------------------------------------!
! Update an individual tree.
!----------------------------------------------------------------------!
USE CONSTANTS
USE CONTROL
USE TREE
!----------------------------------------------------------------------!
IMPLICIT NONE
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
GPP    = 10.0e-6   ! Crown gross photosynthesis             (umol/m^2/s)
Resp   = 0.5 * GPP ! Maintenance respiration                (umol/m^2/s)
Cup = KGCPERMOL * Acrown * (GPP - Resp) ! Net tree C uptake (kgC/tree/s)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
tau = 20.0 * FLOAT (EDPERY * SPERED) ! Structural C residence time   (s)
Clit = Cv / tau  ! Structural litter flux                   (kgC/tree/s)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
dCV = Cup - Clit ! Structural carbon time derivative        (kgC/tree/s)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
Cv = Cv + DTTR * dCv
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
V = Cv / SIGC ! Stem volume                                        (m^3)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Update variables                                                   (m)
!----------------------------------------------------------------------!
r = (V / (( FORMF / 3.0) * PI * alpha * 2.0 ** beta)) &
&   ** (1.0 / (2.0 + beta))       ! Stem radius                      (m)
D = 2.0 * r                       ! Stem diameter                    (m)
H = alpha * r ** beta             ! Stem height                      (m)
Dcrown = a_cd + b_cd * D          ! Crown diameter                   (m)
Acrown = pi * (Dcrown / 2.0) ** 2 ! Crown area                     (m^2)
Acrown = MIN (Parea,Acrown)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
! Accumulate annual diagnostics.
!----------------------------------------------------------------------!
NPP_ann_acc = NPP_ann_acc + DTTR * Cup / (Parea + EPS)
!----------------------------------------------------------------------!

!----------------------------------------------------------------------!
END SUBROUTINE GROW
!======================================================================!
